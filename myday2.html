<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./assets/myday.css">
    <title>My Day</title>
    <script>

        function push() {
            if(document.querySelector('#newtask input').value.length == 0){
            alert("Kindly Enter Task Name!!!!")
            }

            else{
                document.querySelector('#tasks').innerHTML += `
                    <div class="task">
                        <span id="taskname">
                            ${document.getElementById("tasknames").value}
                        </span>
                        <span id="tasktime">
                            ${document.getElementById("tasktimes").value}
                        </span>
                        <button class="delete">
                            <i class="far fa-trash-alt"></i>
                        </button>
                    </div>
                `;

                var current_tasks = document.querySelectorAll(".delete");
                for(var i=0; i<current_tasks.length; i++){
                    current_tasks[i].onclick = function(){
                        this.parentNode.remove();
                    }
                }
            }

        }

        function push2(name, time) {

                document.querySelector('#tasks').innerHTML = document.querySelector('#tasks').innerHTML + `
                    <div class="task">
                        <span id="taskname">` + 
                            name + `
                        </span>
                        <span id="tasktime">` + 
                            time + `
                        </span>
                        <button class="delete">
                            <i class="far fa-trash-alt"></i>
                        </button>
                    </div>
                `;

                var current_tasks = document.querySelectorAll(".delete");
                for(var i=0; i<current_tasks.length; i++){
                    current_tasks[i].onclick = function(){
                        this.parentNode.remove();
                    }
                }
        }
        function getCookie(cname) {
        let name = cname + "=";
        let decodedCookie = decodeURIComponent(document.cookie);
        let ca = decodedCookie.split(';');
        for(let i = 0; i <ca.length; i++) {
          let c = ca[i];
          while (c.charAt(0) == ' ') {
            c = c.substring(1);
          }
          if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
          }
        }
        return "";
      }
        function update_display() {
        // prepare fetch options
        let id = getCookie("id")
        console.log(id)
        const read_options = {
          method: 'GET', // *GET, POST, PUT, DELETE, etc.
          mode: 'cors', // no-cors, *cors, same-origin
          cache: 'default', // *default, no-cache, reload, force-cache, only-if-cached
          credentials: 'omit', // include, *same-origin, omit
          headers: {
            'Content-Type': 'application/json'
          },
        };

        // fetch the data from API
        fetch("https://seal.nighthawkcodingsociety.com/api/users/time", read_options)
          // response is a RESTful "promise" on any successful fetch
          .then(response => {
            // check for response errors
            if (response.status !== 200) {
                const errorMsg = 'Database read error: ' + response.status;
                console.log(errorMsg);
                return;
            }
            // valid response will have json data
            response.json().then(data => {
                for (let i = 0; i<data.length; i++) {
                    if (i == id) {
                        for (let j=0; j<data[i]["tasks"].length; j++) {
                            console.log(data[i]["tasks"][j] + " takes " + data[i]["times"][j] + " minutes")
                            push2(data[i]["tasks"][j], data[i]["times"][j])
                    }
                    }
                }
            })
        })
        // catch fetch errors (ie ACCESS to server blocked)
        .catch(err => {
          console.error(err);
        });
      }
      update_display()
    </script>
    <script src="./assets/js/calculateSleepTime.js"></script>
</head>
<body>
    <div class="container">
        <div id="newtask">
            <input id="tasknames" type="text" placeholder="Add Tasks">
            <input id="tasktimes" type="number" placeholder="Estimated Time">
            <button id="push" onclick="push();">Add</button>
        </div>
        <div id="tasks"></div>
        <h3>Estimated sleep time: </h3>
    </div>
</body>
</html>